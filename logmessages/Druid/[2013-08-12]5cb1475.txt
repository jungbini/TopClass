 fix previous fix because multithread is not correct  