  finished refactoring output collector, still a bug somewhere  