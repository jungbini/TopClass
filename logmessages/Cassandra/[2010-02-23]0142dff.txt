  backport fix for CASSANDRA-781 to 0.5.  patch by jbellis; tested by Hernan Badenes.  I took the approach of changing the StorageProxy code to match 0.6 and then pulling in pieces of 0.6 to make the build work as necessary, rather than trying to make the StorageProxy code match 0.5 better.  This (a) simplifies the backport by making it mostly a matter of copy and paste, reducing the chance of bugs in the backported code that didn't exist in the original, and (b) simplifies future bugfixes in this area, if they should be needed.  git-svn-id: https://svn.apache.org/repos/asf/incubator/cassandra/branches/cassandra-0.5@915437 13f79535-47bb-0310-9956-ffa450edef68  