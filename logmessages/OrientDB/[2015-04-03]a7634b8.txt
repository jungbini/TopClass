  Add some refactoring, fix issue #53  