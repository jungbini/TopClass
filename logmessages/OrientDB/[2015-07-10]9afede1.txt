  improved dirty manager implementation, fixed tracking on map, issue #2629  