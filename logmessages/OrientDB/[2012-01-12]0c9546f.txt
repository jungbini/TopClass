  Contribution by Luca Molino to fix issue 667  