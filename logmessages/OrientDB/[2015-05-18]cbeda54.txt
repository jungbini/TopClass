  fix possible loop on hook, issue #4158  