  fixed refactor bugs on remote protocol for third party compatibility  