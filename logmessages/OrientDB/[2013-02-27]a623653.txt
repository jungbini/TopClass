  Merged changes by henryzhao81 to fix issue #1225  