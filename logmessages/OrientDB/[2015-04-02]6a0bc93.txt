  Add some refactoring, fix issue #54  