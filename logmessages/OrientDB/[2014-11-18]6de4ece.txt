 Merge pull request #3071 from wouterv/detachAll-cycle-fix  #2525 fix for detachAll so it supports cycles  commit 6de4ece802f28431e18f48fa1248cf77b944cb0b  #2525 fix for detachAll so it supports cycles  