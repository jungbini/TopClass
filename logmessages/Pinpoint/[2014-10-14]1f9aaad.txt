 [#26] fix multithread correctness  