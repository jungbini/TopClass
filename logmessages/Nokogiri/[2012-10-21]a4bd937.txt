  More efficient implementation of fix from #726 for #712.  