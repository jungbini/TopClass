  FFI port of 34a14242 (fix for #252)  