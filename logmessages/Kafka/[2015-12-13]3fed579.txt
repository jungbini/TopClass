  KAFKA-2837: Fix transient failure of kafka.api.ProducerBounceTest.testBrokerFailure  I can reproduced this transient failure, it seldom happen; code is like below: // rolling bounce brokers for (i <- 0 until numServers) { for (server <- servers) { server.shutdown() server.awaitShutdown() server.startup() Thread.sleep(2000) }  // Make sure the producer do not see any exception // in returned metadata due to broker failures assertTrue(scheduler.failed == false)  // Make sure the leader still exists after bouncing brokers (0 until numPartitions).foreach(partition => TestUtils.waitUntilLeaderIsElectedOrChanged(zkUtils, topic1, partition)) Brokers keep rolling restart, and producer keep sending messages; In every loop, it will wait for election of partition leader; But if the election is slow, more messages will be buffered in RecordAccumulator's BufferPool; The limit for buffer is set to be 30000; TimeoutException("Failed to allocate memory within the configured max blocking time") will show up when out of memory; Since for every restart of the broker, it will sleep for 2000 ms,  so this transient failure seldom happen; But if I reduce the sleeping period, the bigger chance failure happens; for example if the broker with role of controller suffered a restart, it will take time to select controller first, then select leader, which will lead to more messges blocked in KafkaProducer:RecordAccumulator:BufferPool; In this fix, I just enlarge the producer's buffer size to be 1MB; guozhangwang , Could you give some comments?  Author: jinxing <jinxing@fenbi.com> Author: ZoneMayor <jinxing6042@126.com>  Reviewers: Guozhang Wang  Closes #648 from ZoneMayor/trunk-KAFKA-2837  