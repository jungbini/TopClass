  KAFKA-4205; KafkaApis: fix NPE caused by conversion to array  NPE was caused by `log.logSegments.toArray` resulting in array containing `null` values. The exact reason still remains somewhat a mystery to me, but it seems that the culprit is `JavaConverters` in combination with concurrent data structure access.  Here's a simple code example to prove that: ```scala import java.util.concurrent.ConcurrentSkipListMap // Same as `JavaConversions`, but allows explicit conversions via `asScala`/`asJava` methods. import scala.collection.JavaConverters._  case object Value val m = new ConcurrentSkipListMap[Int, Value.type] new Thread { override def run() = { while (true) m.put(9000, Value) } }.start() new Thread { override def run() = { while (true) m.remove(9000) } }.start() new Thread { override def run() = { while (true) { println(m.values.asScala.toArray.headOption) } } }.start() ```  Running the example will occasionally print `Some(null)` indicating that there's something shady going on during `toArray` conversion.  `null`s magically disappear by making the following change: ```