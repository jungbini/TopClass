  Fix a bunch of bugs in marker generation, and add lots of inline assertions to prevent this from regressing. Right now, Grok has a bunch of checks to work around these bugs, and we would like to get rid of them.  R=jschorr,tylerg DELTA=272  (134 added, 14 deleted, 124 changed)   Revision created by MOE tool push_codebase. MOE_MIGRATION=3268   git-svn-id: https://closure-compiler.googlecode.com/svn/trunk@1442 b0f006be-c8cd-11de-a2e8-8d36a3108c74  