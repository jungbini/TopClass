  WIP Various fixes and performance improvements.  