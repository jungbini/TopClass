  fixed for issue #849(improved TypeRerence Performance) and #937  