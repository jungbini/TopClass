  fix for while-loop-ending-with-if bug  