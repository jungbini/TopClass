  Second post-review fixes for d9054dc04b0eb6ca17af8f5dd64bd781b26e81f1  Added more test cases, fixed bug with another diagnostic  