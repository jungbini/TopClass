  minor fix improvements and integration test  