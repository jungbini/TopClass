  Refactoring daemon tests for more reusable code, adding instances test, minor fixes and improvements  