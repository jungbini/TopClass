 Added tests and fixed gaps in functionality.  