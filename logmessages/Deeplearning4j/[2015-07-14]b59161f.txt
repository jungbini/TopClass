  Name changes for clarity and fixed a few bugs.  