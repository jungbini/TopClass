  addressed comments and fix the deadlock  