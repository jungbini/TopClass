  clean code and some bug fix  