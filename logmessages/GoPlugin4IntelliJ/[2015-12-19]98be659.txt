  Rework function types, fix #2103, possible performance degradation  