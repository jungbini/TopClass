  better type processing, fix #1653  