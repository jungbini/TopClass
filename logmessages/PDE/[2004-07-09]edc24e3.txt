  fixed serial problems and tested on macosx  