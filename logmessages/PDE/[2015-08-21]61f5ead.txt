 fix logic issues and find nearest point  