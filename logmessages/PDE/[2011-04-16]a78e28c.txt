  fix up line endings, improve code quality (issue #522)  