  Port fix for #651 #677  