  Port fix for #382 #296 #378  