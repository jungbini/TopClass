  refactor as prepare to fix WI-12979 (cherry-picked from 3c139ad)  