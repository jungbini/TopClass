  some assertions and test fix  