  proper semaphore usage: fixed race condition described in IDEA-52853  