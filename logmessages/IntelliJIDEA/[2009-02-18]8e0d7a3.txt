  deadlock fix: synchronize both cache and persistent map on a single lock  