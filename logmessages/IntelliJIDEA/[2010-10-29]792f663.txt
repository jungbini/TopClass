  fixed NPE caused by race conditions  