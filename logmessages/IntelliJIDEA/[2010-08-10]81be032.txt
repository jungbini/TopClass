  fix popups: heavy/medium: restore state of factory after popup creation + delegate setPopupType to the original factory  