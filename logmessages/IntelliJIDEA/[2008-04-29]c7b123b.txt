  Slightly refactored to make comprehensible duiring debugging.  