  fix bug with pattern check, tests  