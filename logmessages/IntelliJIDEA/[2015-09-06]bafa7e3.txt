  fixed several possible NPE's  