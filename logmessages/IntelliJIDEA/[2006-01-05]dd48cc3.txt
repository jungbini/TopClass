  fix for IDEADEV-3962 and performance improvement  