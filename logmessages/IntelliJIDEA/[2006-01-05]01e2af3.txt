  fix for IDEADEV-3962 and optimization  