  improvements inspired by the fix to IDEADEV-8367  