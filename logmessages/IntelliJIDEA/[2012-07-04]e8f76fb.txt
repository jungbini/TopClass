  fixed exception and inner function in copy-paste  