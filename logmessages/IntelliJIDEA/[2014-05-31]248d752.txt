  restore classes merge with fix of foreach processing  