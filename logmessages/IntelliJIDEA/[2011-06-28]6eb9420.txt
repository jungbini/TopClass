  fixed failed tests and added test for PY-4027  