  bug fixes. .... this code is in real shambles.  