  Finished test refactoring. Not yet debugged.  